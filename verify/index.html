<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verifica della identit√†</title>
  <link rel="icon" href="https://pack.ultrasmp.online/assets/omega-iconSmall.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- INTRO OVERLAY con logo centrato (rimane nel DOM e poi diventa trasparente) -->
  <div id="intro-overlay" aria-hidden="true">
    <div id="logo-red" aria-hidden="false">
      <img id="logo-red-img" src="Assets/logo_red.jpg" alt="Logo Red">
    </div>
  </div>

  <!-- MAIN: card centrata (menu compatto & elegante) -->
  <main class="main-wrap">
    <section class="verify-wrapper">
      <div id="verify-card" class="card card-center hidden">
        <div class="card-top">
          <div class="card-title">Verifica il tuo permesso</div>
          <p class="card-sub muted">Inserisci la chiave per accedere.</p>
        </div>

        <div class="field">
          <input id="pwdInput" type="password" placeholder="Inserisci chiave" autocomplete="off" />
        </div>

        <div id="status" class="status muted" aria-live="polite"></div>

        <div class="controls" style="margin-top:14px;">
          <button id="verifyBtn" class="btn-primary">Verificati</button>
          <button id="clearBtn" class="btn-secondary">Cancella</button>
          <button id="deleteBtn" class="btn-danger">Elimina</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // percorso immagine (come fornito)
    const LOGO_SRC = 'Assets/logo_red.jpg';
    const ROOT = 'https://0ffalexis.github.io/';

    // Intro animation: 3 spin, scale up ogni spin, poi move up and reveal form
    function runIntroSequence() {
      const overlay = document.getElementById('intro-overlay');
      const logo = document.getElementById('logo-red');
      const logoImg = document.getElementById('logo-red-img');
      const verifyCard = document.getElementById('verify-card');

      // ensure src
      if (LOGO_SRC) logoImg.src = LOGO_SRC;

      // prepare vars
      const spinsTotal = 3;
      const spinDuration = 700;
      const betweenDelay = 140;

      logo.style.opacity = '1';
      logo.dataset.rot = '0';

      // helper for single spin
      function doSpin(index) {
        return new Promise(resolve => {
          const scale = 1 + index * 0.28; // cresce ogni spin
          const prevRot = parseInt(logo.dataset.rot || '0', 10);
          const newRot = prevRot + 360;
          logo.dataset.rot = String(newRot);
          // use transition for smooth spin+scale
          logo.style.transition = `transform ${spinDuration}ms cubic-bezier(.2,.9,.25,1)`;
          logo.style.transform = `translate(-50%,-50%) rotate(${newRot}deg) scale(${scale})`;
          setTimeout(() => resolve(), spinDuration + 20);
        });
      }

      (async () => {
        // initial slightly smaller
        logo.style.transform = 'translate(-50%,-50%) scale(0.9)';

        // do the spins
        for (let i = 0; i < spinsTotal; i++) {
          await doSpin(i);
          await new Promise(r => setTimeout(r, betweenDelay));
        }

        // after spins: move logo to top and fix it there, keep it rotating forever
        logo.style.transition = 'all 700ms cubic-bezier(.22,.9,.32,1)';
        logo.style.top = '40px';      // posizione alta
        logo.style.left = '50%';
        logo.style.transform = `translate(-50%,-50%) rotate(${logo.dataset.rot || 0}deg) scale(1)`;
        logo.classList.add('settled'); // adds slow infinite rotation via CSS

        // reveal the form (centered and slightly raised)
        setTimeout(() => {
          overlay.classList.add('overlay-revealed'); // makes overlay transparent but logo stays
          verifyCard.classList.remove('hidden');
          verifyCard.classList.add('visible');
        }, 420);

        // keep overlay in the DOM (so logo remains interactive/visible above everything)
        // (no removal)
      })();
    }

    // Button logic
    function setupControls() {
      const STORAGE_KEY = 'savedPassword';
      const pwdInput = document.getElementById('pwdInput');
      const verifyBtn = document.getElementById('verifyBtn');
      const clearBtn = document.getElementById('clearBtn');
      const deleteBtn = document.getElementById('deleteBtn');
      const status = document.getElementById('status');

      function setStatus(text, type='muted') {
        status.textContent = text;
        status.className = 'status';
        if (type === 'good') status.classList.add('good');
        if (type === 'warn') status.classList.add('warn');
      }

      verifyBtn.addEventListener('click', () => {
        const v = pwdInput.value.trim();
        if (!v) { setStatus('Inserisci la chiave prima.', 'warn'); return; }
        if (v === 'RPAdmin') {
          setStatus('Accesso riconosciuto: RPAdmin. Reindirizzamento...', 'good');
          setTimeout(() => window.location.href = ROOT + 'Entities', 500);
          return;
        }
        if (v === 'admin') {
          setStatus('Accesso admin: aprendo risorsa...', 'good');
          setTimeout(() => window.location.href = 'https://www.youtube.com/watch?v=xvFZjo5PgG0', 500);
          return;
        }
        try {
          const stored = localStorage.getItem(STORAGE_KEY);
          if (stored && v === stored) {
            setStatus('Chiave valida. Reindirizzamento...', 'good');
            setTimeout(() => window.location.href = ROOT + 'Entities', 500);
            return;
          } else {
            setStatus('Chiave non valida.', 'warn');
          }
        } catch (e) {
          setStatus('Errore durante la verifica.', 'warn');
        }
      });

      clearBtn.addEventListener('click', () => {
        pwdInput.value = '';
        setStatus('Input cancellato.', 'muted');
      });

      deleteBtn.addEventListener('click', () => {
        try {
          localStorage.removeItem(STORAGE_KEY);
          setStatus('Chiave salvata eliminata (se presente).', 'good');
        } catch (e) {
          setStatus('Errore durante l\'eliminazione.', 'warn');
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      runIntroSequence();
      setupControls();
    });
  </script>
</body>
</html>
