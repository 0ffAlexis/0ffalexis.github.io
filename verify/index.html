<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="https://pack.ultrasmp.online/assets/omega-iconSmall.png" type="image/png" />
  <title>Verifica della identità</title>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- CSS esterno -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- INTRO OVERLAY -->
  <div id="intro-overlay" aria-hidden="true">
    <div id="logo-red" role="img" aria-label="Logo Red">
      <!-- percorso fornito da te (Assets/logo_red.jpg) -->
      <img id="logo-red-img" src="Assets/logo_red.jpg" alt="Logo Red">
    </div>
  </div>

  <!-- CONTENT (VERIFICA) -->
  <div class="card" aria-live="polite">
    <br><br>
    <!-- Manteniamo l'omega originale qui: sarà sostituita via JS dall'animazione -->
    <img src="https://pack.ultrasmp.online/assets/omega-icon.png" alt="Omega Icon" class="omega">
    <h1>Verifica la tua identità</h1>
    <p class="lead">Inserisci la chiave per accedere a questo sito.</p>

    <div class="field">
      <input id="pwdInput" type="password" placeholder="Inserisci chiave">
      <button id="toggleShow" class="icon-btn">Mostra</button>
    </div>

    <div id="status" class="status"></div>

    <div class="controls">
      <button id="saveBtn" class="btn-primary">Salva</button>
      <button id="loadBtn" class="btn-secondary">Carica</button>
      <button id="clearBtn" class="btn-danger">Cancella</button>
    </div>

  </div>

  <!-- JS: mantiene tutto il comportamento (intro + replace + verfica/localStorage) -->
  <script>
    // percorso immagine come richiesto
    const LOGO_SRC = 'Assets/logo_red.jpg';

    // funzione che esegue l'intro e sostituisce la .omega al termine
    function runIntroReplaceOmega() {
      const overlay = document.getElementById('intro-overlay');
      const logoWrap = document.getElementById('logo-red');
      const logoImg = document.getElementById('logo-red-img');

      if (LOGO_SRC) logoImg.src = LOGO_SRC;

      // avvia l'emersione
      logoWrap.classList.add('anim-emerge');

      // dopo l'emerge, calcoliamo spostamento verso .omega
      logoWrap.addEventListener('animationend', function onEmerge(e) {
        if (e.animationName !== 'emerge') return;
        logoWrap.removeEventListener('animationend', onEmerge);

        const target = document.querySelector('.omega');

        if (!target) {
          // fallback: svela la pagina
          overlay.classList.add('overlay-fadeout');
          setTimeout(() => overlay.remove(), 700);
          return;
        }

        // aggiungi transizione di movimento
        logoWrap.classList.add('anim-move');

        // bounding boxes
        const logoRect = logoWrap.getBoundingClientRect();
        const targetRect = target.getBoundingClientRect();

        // centri
        const logoCx = logoRect.left + logoRect.width / 2;
        const logoCy = logoRect.top + logoRect.height / 2;
        const targetCx = targetRect.left + targetRect.width / 2;
        const targetCy = targetRect.top + targetRect.height / 2;

        // delta
        const dx = Math.round(targetCx - logoCx);
        const dy = Math.round(targetCy - logoCy);

        // scala finale (manteniamo proporzione)
        const scale = Math.min(targetRect.width / logoRect.width, targetRect.height / logoRect.height, 1);

        // applica trasformazione (tenendo il translate(-50%,-50%) di base)
        logoWrap.style.transform = `translate(-50%, -50%) translate(${dx}px, ${dy}px) scale(${scale})`;

        // al termine della transition => sostituisci la .omega
        const onTransitionEnd = () => {
          logoWrap.removeEventListener('transitionend', onTransitionEnd);

          // se target è immagine, sostituisci src e applica rotazione lenta
          if (target.tagName.toLowerCase() === 'img') {
            target.src = LOGO_SRC;
            target.style.animation = 'slow-rotate 6s linear infinite';
            target.style.filter = 'drop-shadow(0 10px 36px rgba(255,0,0,0.25))';
            target.style.opacity = '1';
          } else {
            // fallback: appendi un clone sopra il target
            const clone = logoImg.cloneNode(true);
            clone.style.width = Math.max(32, targetRect.width) + 'px';
            clone.style.height = 'auto';
            clone.style.display = 'block';
            clone.style.position = 'fixed';
            clone.style.left = `${targetCx}px`;
            clone.style.top = `${targetCy}px`;
            clone.style.transform = 'translate(-50%,-50%)';
            clone.style.zIndex = 9998;
            document.body.appendChild(clone);
            clone.style.animation = 'slow-rotate 6s linear infinite';
          }

          // fade out overlay
          overlay.classList.add('overlay-fadeout');

          // rimuovi overlay dopo la fade
          setTimeout(() => {
            if (overlay && overlay.parentElement) overlay.parentElement.removeChild(overlay);
          }, 700);
        };

        logoWrap.addEventListener('transitionend', onTransitionEnd);
      });
    }

    // Avvio all'evento DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      // lancia l'intro (commenta la riga sotto se vuoi saltarla)
      runIntroReplaceOmega();
    });


    /* =========================
       LOGICA SALVATAGGIO / UI (invariata)
       ========================= */
    const STORAGE_KEY = 'savedPassword';
    let savedPasswordVar = null;

    const pwdInput = document.getElementById('pwdInput');
    const toggleShow = document.getElementById('toggleShow');
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const clearBtn = document.getElementById('clearBtn');
    const status = document.getElementById('status');

    toggleShow.addEventListener('click', () => {
      const isHidden = pwdInput.type === 'password';
      pwdInput.type = isHidden ? 'text' : 'password';
      toggleShow.textContent = isHidden ? 'Nascondi' : 'Mostra';
    });

    saveBtn.addEventListener('click', () => {
      const v = pwdInput.value.trim();
      if (!v) return setStatus('Devi inserire la chiave prima.', 'warn');
      savedPasswordVar = v;
      try {
        localStorage.setItem(STORAGE_KEY, v);
        setStatus('Chiave salvata con successo.', 'good');
        setTimeout(() => window.location.replace("https://0ffalexis.github.io"), 600);
      } catch (e) {
        setStatus('Errore durante il salvataggio.', 'warn');
      }
    });

    loadBtn.addEventListener('click', () => {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) return setStatus('Nessuna chiave trovata.', 'warn');
        savedPasswordVar = stored;
        pwdInput.value = stored;
        setStatus('Chiave caricata.', 'good');
      } catch (e) {
        setStatus('Errore durante il caricamento.', 'warn');
      }
    });

    clearBtn.addEventListener('click', () => {
      savedPasswordVar = null;
      pwdInput.value = '';
      try {
        localStorage.removeItem(STORAGE_KEY);
        setStatus('Chiave eliminata.', 'good');
      } catch (e) {
        setStatus('Errore durante la cancellazione.', 'warn');
      }
    });

    function setStatus(text, type) {
      status.textContent = text;
      status.className = 'status';
      if (type === 'good') status.classList.add('good');
      if (type === 'warn') status.classList.add('warn');
    }
  </script>
</body>
</html>
