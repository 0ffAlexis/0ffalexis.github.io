<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verifica della identit√†</title>
  <link rel="icon" href="https://pack.ultrasmp.online/assets/omega-iconSmall.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- RIFT line (visuale) -->
  <div class="rift" aria-hidden="true">
    <div class="rift-line"></div>
  </div>

  <!-- INTRO OVERLAY con logo centrato -->
  <div id="intro-overlay" aria-hidden="true">
    <div id="logo-red" aria-hidden="false">
      <img id="logo-red-img" src="Assets/logo_red.jpg" alt="Logo Red">
    </div>
  </div>

  <!-- MAIN LAYOUT -->
  <main class="container">
    <!-- Left column (portrait / decorative) - kept minimal -->
    <section class="left-col">
      <div class="portrait">
        <img id="portrait-img" class="entity-image" src="Assets/logo_red.jpg" alt="Logo" />
      </div>

      <div class="card card-left">
        <div class="card-title">Informazioni</div>
        <div class="card-subtitle muted">Verifica e gestione permessi</div>
        <div class="stats-list">
          <div class="stat"><span class="label">Status</span><span class="value">In attesa</span></div>
        </div>
      </div>
    </section>

    <!-- Right column: qui compare il form -->
    <section class="right-col">
      <div id="verify-card" class="card card-right hidden">
        <div class="card-title entity-title">Verifica il tuo permesso</div>
        <p class="muted" style="margin:8px 0 14px 0;">Inserisci la chiave per accedere.</p>

        <div class="field">
          <input id="pwdInput" type="password" placeholder="Inserisci chiave" autocomplete="off" />
        </div>

        <div id="status" class="status muted" aria-live="polite"></div>

        <div class="controls" style="margin-top:18px;">
          <button id="verifyBtn" class="btn-primary">Verificati</button>
          <button id="clearBtn" class="btn-secondary">Cancella</button>
          <button id="deleteBtn" class="btn-danger">Elimina</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // percorso immagine (come fornito)
    const LOGO_SRC = 'Assets/logo_red.jpg';
    const ROOT = 'https://0ffalexis.github.io/';

    // Intro animation: 3 spin, scale up ogni spin, poi move up and reveal form
    function runIntroSequence() {
      const overlay = document.getElementById('intro-overlay');
      const logo = document.getElementById('logo-red');
      const logoImg = document.getElementById('logo-red-img');
      const verifyCard = document.getElementById('verify-card');

      // ensure src
      if (LOGO_SRC) logoImg.src = LOGO_SRC;

      // prepare
      let spinCount = 0;
      const spinsTotal = 3;
      const delays = { spinMs: 700, betweenMs: 150 };

      // helper: perform one spin with increased scale
      function doSpin(index) {
        return new Promise((resolve) => {
          // calculate scale: start ~1.0 then +0.2 each spin
          const scale = 1 + index * 0.2;
          // apply transform with rotation and scale
          logo.style.transition = `transform ${delays.spinMs}ms cubic-bezier(.2,.9,.25,1)`;
          // rotate by 360deg each time (cumulative)
          const prevRot = logo.dataset.rot ? parseInt(logo.dataset.rot,10) : 0;
          const newRot = prevRot + 360;
          logo.dataset.rot = newRot;
          logo.style.transform = `translate(-50%,-50%) rotate(${newRot}deg) scale(${scale})`;
          // after animation end
          setTimeout(() => resolve(), delays.spinMs + 20);
        });
      }

      // run all spins sequentially
      (async () => {
        // initial center baseline
        logo.style.transform = 'translate(-50%,-50%) scale(0.9)';
        logo.style.opacity = '1';
        for (let i = 0; i < spinsTotal; i++) {
          await doSpin(i);
          await new Promise(r => setTimeout(r, delays.betweenMs));
        }

        // after spins: move logo to top center and make it slightly smaller and settled
        // set smoother transition
        logo.style.transition = 'all 700ms cubic-bezier(.22,.9,.32,1)';
        // position top near header area
        logo.style.top = '64px';
        logo.style.left = '50%';
        // smaller scale for header
        logo.style.transform = `translate(-50%,-50%) rotate(${logo.dataset.rot || 0}deg) scale(0.9)`;
        // add slow rotation loop (via CSS class)
        logo.classList.add('settled');

        // reveal the form (fade in)
        setTimeout(() => {
          // fade overlay background to transparent and allow interactions
          overlay.classList.add('overlay-revealed');
          // show verify card
          verifyCard.classList.remove('hidden');
          verifyCard.classList.add('visible');
        }, 450);

        // remove overlay DOM after a bit to keep page clean (optional)
        setTimeout(() => {
          if (overlay && overlay.parentElement) {
            overlay.parentElement.removeChild(overlay);
          }
        }, 1200);
      })();
    }

    // Verification logic for the three buttons
    function setupControls() {
      const STORAGE_KEY = 'savedPassword';
      const pwdInput = document.getElementById('pwdInput');
      const verifyBtn = document.getElementById('verifyBtn');
      const clearBtn = document.getElementById('clearBtn');
      const deleteBtn = document.getElementById('deleteBtn');
      const status = document.getElementById('status');

      function setStatus(text, type='muted') {
        status.textContent = text;
        status.className = 'status';
        if (type === 'good') status.classList.add('good');
        if (type === 'warn') status.classList.add('warn');
      }

      verifyBtn.addEventListener('click', () => {
        const v = pwdInput.value.trim();
        if (!v) { setStatus('Inserisci la chiave prima.', 'warn'); return; }
        // rules: RPAdmin -> Entities, admin -> youtube, otherwise check saved
        if (v === 'RPAdmin') {
          setStatus('Accesso riconosciuto: RPAdmin. Reindirizzamento...', 'good');
          setTimeout(() => window.location.href = ROOT + 'Entities', 500);
          return;
        }
        if (v === 'admin') {
          setStatus('Accesso admin: aprendo risorsa...', 'good');
          setTimeout(() => window.location.href = 'https://www.youtube.com/watch?v=xvFZjo5PgG0', 500);
          return;
        }
        try {
          const stored = localStorage.getItem(STORAGE_KEY);
          if (stored && v === stored) {
            setStatus('Chiave valida. Reindirizzamento...', 'good');
            setTimeout(() => window.location.href = ROOT + 'Entities', 500);
            return;
          } else {
            setStatus('Chiave non valida.', 'warn');
          }
        } catch (e) {
          setStatus('Errore durante la verifica.', 'warn');
        }
      });

      clearBtn.addEventListener('click', () => {
        pwdInput.value = '';
        setStatus('Input cancellato.', 'muted');
      });

      deleteBtn.addEventListener('click', () => {
        try {
          localStorage.removeItem(STORAGE_KEY);
          setStatus('Chiave salvata eliminata (se presente).', 'good');
        } catch (e) {
          setStatus('Errore durante l\'eliminazione.', 'warn');
        }
      });
    }

    // on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      // start intro
      runIntroSequence();
      setupControls();
    });
  </script>
</body>
</html>
